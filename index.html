<!DOCTYPE html>
<html>

<head>
    <title>A Leaflet map!</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.Default.css" />
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="./Leaflet.markercluster-1.0.5/leaflet.markercluster.js"></script>
    <script src="./Leaflet.heat-0.2.0/leaflet-heat.js"></script>

  <style>
    body, html {
      height: 100%;
      width: 100%;
    }

    #map {
      width: 100%;
      height: 640px;
    }
  </style>

</head>

<body>
  <h1>Studio Week 4 <br> Boston Rat Map </h1>
  <ul>
  	<li><a class="active" href="index.html" target="_self">Output 1</a></li>
    <li><a href="google-sheet.html" target="_self">Output 2</a></li>
    <li><a href="choose-your-own-adventure.html" target="_self">Output 3</a></li>
  </ul>
  <br>

  <div id="map"></div>

  <script>
  // initialize the map
  var map = L.map('map').setView([42.35, -71.08], 13);

  // load a tile layer
  L.tileLayer('https://tiles.stadiamaps.com/tiles/osm_bright/{z}/{x}/{y}{r}.png', {
  	maxZoom: 20,
  	attribution: '&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'
  }).addTo(map);

    // // Rat gif
    // $.getJSON("./Data/rodents.geojson", function(data) {
    //   var ratIcon = L.icon({
    //     iconUrl: './Data/rat.gif',
    //     iconSize: [50,40]
    //   });
    //
    //   L.geoJson(data, {
    //     pointToLayer: function(feature, latlng) {
    //       return L.marker(latlng, { icon: ratIcon } );
    //     }
    //   }).addTo(map);
    // });

    $.getJSON("./Data/neighborhoods.geojson",function(hoodData){
      L.geoJson( hoodData, {
        style: function(feature){
          var fillColor, density = feature.properties.density;
          if ( density > 80 ) fillColor = "#006837";
          else if ( density > 40 ) fillColor = "#31a354";
          else if ( density > 20 ) fillColor = "#78c679";
          else if ( density > 10 ) fillColor = "#c2e699";
          else if ( density > 0 ) fillColor = "#ffffcc";
          else fillColor = "#f7f7f7";  // no data
          return { color: "#999", weight: 1, fillColor: fillColor, fillOpacity: .6 };
        },
        onEachFeature: function( feature, layer ){
          layer.bindPopup( "<strong>" + feature.properties.Name + "</strong><br/>" + feature.properties.density + " rats per square mile" )
        }
      }).addTo(map);
    });

    // // Rat png (Pop up and Cluster)
    // $.getJSON("./Data/rodents.geojson", function(data) {
    //   var ratIcon = L.icon({
    //     iconUrl: 'http://andywoodruff.com/maptime-leaflet/rat.png',
    //     iconSize: [60,50]
    //   });
    //
    // //   // Rat png: Pop up
    // //   L.geoJson(data, {
    // //     pointToLayer: function(feature, latlng) {
    // //       var marker = L.marker(latlng, {icon: ratIcon});
    // //       marker.bindPopup(feature.properties.Location + '<br/>' + feature.properties.OPEN_DT);
    // //       return marker;
    // //     }
    // //   }).addTo(map);
    // // });
    //
    //   // Rat png: Cluster (Plug in and thin out)
    //   var rodents = L.geoJson(data, {
    //     pointToLayer: function(feature, latlng) {
    //       var marker = L.marker(latlng, {icon: ratIcon});
    //       marker.bindPopup(feature.properties.Location + '<br/>' + feature.properties.OPEN_DT);
    //       return marker;
    //     }
    //   });
    //
    //   var clusters = L.markerClusterGroup();
    //   clusters.addLayer(rodents);
    //   map.addLayer(clusters);
    // });

    map.setZoom(12);
    $.getJSON("./Data/rodents.geojson",function(data) {
      var locations = data.features.map(function(rat) {
        // the heatmap plugin wants an array of each location
        var location = rat.geometry.coordinates.reverse();
        location.push(0.5);
        return location; // e.g. [50.5, 30.5, 0.2], // lat, lng, intensity
      });

      var heat = L.heatLayer(locations, { radius: 35 });
      map.addLayer(heat);
    });

  </script>

</body>

</html>
